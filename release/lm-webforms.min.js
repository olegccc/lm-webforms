!function(a,b){"function"==typeof define&&define.amd?define(["angular","angular_animate","angular_translate","angular_messages","angular_material","angular_aria","angular_touch","autolinker","recaptcha"],function(a,c,d,e,f,g,h,i,j){return b(a,c,d,e,f,g,h,i,j)}):"object"==typeof exports?module.exports=b(require("angular"),require("angular_animate"),require("angular_translate"),require("angular_messages"),require("angular_material"),require("angular_aria"),require("angular_touch"),require("autolinker"),require("recaptcha")):b(angular)}(this,function(angular,a,b,c,d,e,f,autolinker,recaptcha){function g(a){switch(a){case k.TEXT:return"text";case k.CODE_TEXT:return"codeText";case k.BOOLEAN:return"checkBox";case k.DATE:return"date";case k.EMAIL:return"email";case k.FILE:return"file";case k.FILE_LIST:return"fileList";case k.IMAGE:return"image";case k.LABEL:return"label";case k.MULTILINE_TEXT:return"multilineText";case k.MULTI_SELECT:return"multiSelect";case k.NUMBER:return"number";case k.PASSWORD:return"password";case k.RICH_TEXT:return"richText";case k.SELECT:return"select";case k.TYPEAHEAD:return"typeahead"}}var h=angular.module("lm-webforms",["ngMaterial","ngTouch","ngMessages","ngAnimate","pascalprecht.translate"]),i={"views/codemirror.jade":'<div class="md-input CodeMirrorInput"></div>',"views/fileRead.jade":'<input type="file" style="opacity: 0; height: 0; width: 0; display: inline"/><md-button ng-click="chooseFile()"><md-icon>attach_file</md-icon></md-button><md-button ng-click="clear()" ng-show="valueSet"><md-icon>clear</md-icon></md-button><span>{{comment}}</span><div ng-if="showImage" class="file-image"><canvas style="width:150px;height:150px" ng-show="imageLoaded"></canvas></div>',"views/inputFieldError.jade":'<div ng-messages="form[field.property].$error" ng-show="form[field.property].$dirty"><div ng-message="{{requiredMarker}}">{{ configuration.requiredErrorMessage | translate }}</div><div ng-message="{{maxLengthMarker}}">{{ maxLengthMessage }}</div><div ng-message="{{minLengthMarker}}">{{ minLengthMessage }}</div><div ng-message="{{emailMarker}}">{{ configuration.emailErrorMessage | translate }}</div><div ng-message="{{urlMarker}}">{{ configuration.urlErrorMessage | translate }}</div><div ng-message="{{patternMarker}}">{{ configuration.patternErrorMessage | translate }}</div><div ng-message="{{dateMarker}}">{{ configuration.dateErrorMessage | translate }}</div><div ng-message="{{timeMarker}}">{{ configuration.timeErrorMessage | translate }}</div><div ng-message="{{numberMarker}}">{{ configuration.numberErrorMessage | translate }}</div><div ng-message="{{equalsMarker}}">{{ configuration.notEqualErrorMessage | translate }}</div></div>',"views/inputFields/checkBox.jade":'<md-checkbox name="{{field.property}}" ng-model="object[field.property]" ng-disabled="readOnly(field)">{{field.title | translate}}</md-checkbox>',"views/inputFields/codeText.jade":'<style>.CodeMirror {\n    line-height: normal;\n    height: 200px !important;\n}\n.CodeMirrorInput {\n    border-width: 1px !important;\n    border-style: solid;\n    border-radius: 3px;\n}\n.md-input-focused .CodeMirrorInput {\n    border-width: 2px !important;\n}\nmd-input-container:not(.md-input-focused):not(.md-input-has-value) .CodeMirrorLabel {\n    padding-left: 40px;\n}\n</style><label class="CodeMirrorLabel">{{field.title | translate}}</label><link href="../../bower_components/codemirror/lib/codemirror.css" rel="stylesheet" type="text/css"/><ui-codemirror ng-model="object[field.property]" name="{{field.property}}" ng-required="field.required" field-readonly="readOnly(field) || fieldDisabled" options="getCodeMirrorOptions()"></ui-codemirror>',"views/inputFields/date.jade":'<label>{{field.title | translate}}</label><input type="date" name="{{field.property}}" ng-model="object[field.property]" ng-readonly="readonly(field)" ng-required="field.required"/>',"views/inputFields/email.jade":'<label>{{field.title | translate}}</label><input type="email" name="{{field.property}}" ng-model="object[field.property]" ng-readonly="readOnly(field)" ng-disabled="fieldDisabled" ng-required="field.required" ng-minlength="field.minLength" ng-maxlength="field.maxLength" validate-equals="{{field.reference}}" reference="{{field.reference === null || object[field.reference]}}"/>',"views/inputFields/file.jade":'<label>{{field.title | translate}}</label><style>md-input-container file-read.md-input {\n    border-width: 1px !important;\n}\nmd-input-container file-read.md-input.ng-invalid.ng-dirty {\n    border-width: 1px;\n    border-style: solid;\n}\nmd-input-container.md-input-focused file-read.md-input {\n    border-width: 1px;\n    border-style: solid;\n}\n</style><file-read ng-model="object[field.property]" style="height: auto" ng-required="field.required" name="{{field.property}}" class="md-input"></file-read>',"views/inputFields/fileList.jade":'<label>{{field.title | translate}}</label><style>md-input-container multi-file-read.md-input {\n    border-width: 1px !important;\n}\nmd-input-container multi-file-read.md-input.ng-invalid.ng-dirty {\n    border-width: 1px;\n    border-style: solid;\n}\nmd-input-container.md-input-focused multi-file-read.md-input {\n    border-width: 1px;\n    border-style: solid;\n}\n</style><multi-file-read ng-model="object[field.property]" ng-required="field.required" name="{{field.property}}" class="md-input"></multi-file-read>',"views/inputFields/image.jade":'<label>{{field.title | translate}}</label><style>md-input-container file-read.md-input {\n    border-width: 1px !important;\n}\n\nmd-input-container file-read.md-input.ng-invalid.ng-dirty {\n    border-width: 1px;\n    border-style: solid;\n}\n\nmd-input-container.md-input-focused file-read.md-input {\n    border-width: 1px;\n    border-style: solid;\n}</style><file-read ng-model="object[field.property]" style="height: auto" ng-required="field.required" name="{{field.property}}" show-image="true" class="md-input"></file-read>',"views/inputFields/label.jade":'<label>{{field.title | translate}}</label><div ng-bind="object[field.property]" style="position: relative; top: 1.5em;" class="md-input"></div>',"views/inputFields/multiSelect.jade":'<md-select name="{0}" ng-model="object[field.property]" ng-readonly="readOnly(field) || fieldDisabled" placeholder="{{ field.title | translate }}" ng-disabled="fieldDisabled" ng-required="field.required" validate-equals="{{field.reference}}" reference="{{field.reference === null || object[field.reference]}}" multiple="true"><md-optgroup ng-repeat="group in field.itemsArray | filter: { isGroup: true }" label="{{group.text}}"><md-option ng-repeat="item in group.items" ng-value="item.key">{{ item.text }}</md-option></md-optgroup><md-option ng-repeat="item in field.itemsArray | filter: { isGroup: false }" value="{{item.key}}">{{ item.text }}</md-option></md-select>',"views/inputFields/multilineText.jade":'<label>{{field.title | translate}}</label><textarea ng-model="object[field.property]" ng-readonly="readOnly(field)"></textarea>',"views/inputFields/number.jade":'<label>{{field.title | translate}}</label><input type="number" name="{{field.property}}" ng-model="object[field.property]" ng-readonly="readOnly(field) || fieldDisabled" ng-disabled="fieldDisabled" ng-required="required" ng-minlength="field.minLength" ng-maxlength="field.maxLength" validate-equals="{{field.reference}}" reference="{{field.reference === null || object[field.reference]}}"/>',"views/inputFields/password.jade":'<label>{{field.title | translate}}</label><input type="password" name="{{field.property}}" ng-model="object[field.property]" ng-readonly="readOnly(field)" ng-required="field.required" ng-minlength="field.minLength" ng-maxlength="field.maxLength" validate-equals="{{field.reference}}" reference="{{field.reference === null || object[field.reference]}}"/>',"views/inputFields/richText.jade":'<label>{{field.title | translate}}</label><style>md-input-container ck-editor.md-input {\n    border-width: 0;\n}\nmd-input-container ck-editor.md-input.ng-invalid.ng-dirty {\n    border-width: 2px;\n    border-style: solid;\n}\nmd-input-container.md-input-focused ck-editor.md-input {\n    border-width: 2px;\n    border-style: solid;\n}\n</style><ck-editor ng-if="!readOnly(field)" ng-model="object[field.property]" options="{}" readonly="false" ng-required="field.required" name="{{field.property}}" class="md-input"></ck-editor><div ng-if="readOnly(field)" ng-bind-html="object[field.property]"></div>',"views/inputFields/select.jade":'<md-select name="{0}" ng-model="object[field.property]" ng-readonly="readOnly(field) || fieldDisabled" placeholder="{{ field.title | translate }}" ng-disabled="fieldDisabled" ng-required="field.required" validate-equals="{{field.reference}}" reference="{{field.reference === null || object[field.reference]}}"><md-optgroup ng-repeat="group in field.itemsArray | filter: { isGroup: true }" label="{{group.text}}"><md-option ng-repeat="item in group.items" ng-value="item.key">{{ item.text }}</md-option></md-optgroup><md-option ng-repeat="item in field.itemsArray | filter: { isGroup: false }" value="{{item.key}}">{{ item.text }}</md-option></md-select>',"views/inputFields/text.jade":'<label>{{field.title | translate}}</label><input type="text" name="{{field.property}}" ng-model="object[field.property]" ng-readonly="readOnly(field) || fieldDisabled" ng-disabled="fieldDisabled" ng-required="field.required" ng-minlength="field.minLength" ng-maxlength="field.maxLength" validate-equals="{{field.reference}}" reference="{{field.reference === null || object[field.reference]}}"/>',"views/inputFields/typeahead.jade":'<md-autocomplete md-input-name="{{field.property}}" md-no-cache="true" md-floating-label="{{field.title | translate}}" md-selected-item="object[field.property]" md-search-text="searchText" md-items="item in getTypeahead(searchText)" md-item-text="object[field.property]" md-search-text-change="onSearchTextChange(searchText)" md-selected-item-change="onSelectedItemChange()" ng-readonly="readOnly() || fieldDisabled" ng-disabled="fieldDisabled" ng-required="field.required" ng-minlength="field.minLength" ng-maxlength="field.maxLength"><md-item-template><span md-highlight-text="searchText">{{item}}</span></md-item-template><md-not-found>{{configuration.notFoundMessage}}</md-not-found><input-field-error></input-field-error></md-autocomplete>',"views/multiFileRead.jade":'<style>.file-choose-list, .file-choose-list li {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n}\n\n.file-choose-list li {\n    display: inline-block;\n}\n\n.file-choose-list li:not(:first-child) {\n    margin-left: 0.5em;\n}\n\n.file-choose-list li:first-child {\n    margin-top: 0.5em;\n}\n\n.file-choose-list li:last-child {\n    margin-bottom: 1em;\n}\n\n.file-choose-list li md-icon {\n    margin-left: 5px;\n    cursor: pointer;\n}\n\n</style><ul class="file-choose-list"><li ng-repeat="file in files"><md-icon>attach_file</md-icon><span>{{file.name}}</span><md-icon ng-click="removeFile(file)" class="file-remove">clear</md-icon></li><li><md-button ng-click="chooseFile()"><md-icon ng-if="files.length &gt; 0">add_circle</md-icon><md-icon ng-if="files.length === 0">attach_file</md-icon></md-button></li></ul><input type="file" style="display: none" multiple="multiple"/>',"views/webDialog.jade":'<div ng-form="form"><div ng-if="!changesApplied"><md-content layout-padding="layout-padding" layout="column"><style>md-input-container.inputfield-file label,\nmd-input-container.inputfield-image label,\nmd-input-container.inputfield-file_list label {\n    flex: none;\n    -webkit-flex: none;\n    transform: none !important;\n}\n</style><div ng-repeat="field in fields | orderBy: \'position\'" class="{{\'field-\' + field.type + \' \' + \'field-list\'}}"><input-field field="field" object="object" form="form" ng-if="fieldVisible(field) &amp;&amp; !field.isGroup" field-disabled="isApplying"></input-field><div ng-if="field.isGroup" layout="row" layout-sm="column"><input-field ng-repeat="child in field.children | orderBy: \'position\'" field="child" object="object" form="form" ng-if="fieldVisible(child)" flex="" field-disabled="isApplying"></input-field></div></div><div ng-if="submitWithCaptcha" captcha="recaptchaPublicKey"></div><div ng-if="submitError.length &gt; 0" class="bg-danger dialog-notification"><span class="glyphicon glyphicon-exclamation-sign"></span><span ng-bind="submitError"></span></div><div ng-if="submitSuccess.length &gt; 0" class="bg-success dialog-notification"><span class="glyphicon glyphicon-ok-circle"></span><span ng-bind="submitSuccess"></span></div></md-content><md-content layout-padding="layout-padding"><md-button ng-click="submit(form)" ng-disabled="okDisabled(form)" class="md-raised md-primary"><span ng-bind="applyCaption | translate"></span><md-progress-circular ng-show="isApplying" md-mode="indeterminate" md-diameter="10"></md-progress-circular></md-button></md-content></div><div ng-if="changesApplied"><div ng-bind="submitSuccess" class="bg-success dialog-notification"></div><md-content layout-padding="layout-padding"><md-button ng-click="openForm(form)" ng-bind="\'Open Form\' | translate" aria-label="Open" class="md-raised"></md-button></md-content></div></div>',"views/webForm.jade":'<md-dialog ng-form="form" aria-label="{{title}}" flex="80"><md-toolbar><div class="md-toolbar-tools"><h2>{{title}}</h2><span flex="flex"></span><md-button ng-click="cancel()" ng-disabled="isApplying" class="md-icon-button"><md-icon>clear</md-icon></md-button></div></md-toolbar><md-content layout-padding="layout-padding" layout="column"><style>md-input-container.inputfield-file label,\nmd-input-container.inputfield-image label,\nmd-input-container.inputfield-file_list label {\n    flex: none;\n    -webkit-flex: none;\n    transform: none !important;\n}\n</style><div ng-repeat="field in fields | orderBy: \'position\'" class="{{\'field-\' + field.type + \' \' + \'field-list\'}}"><input-field field="field" object="object" form="form" ng-if="fieldVisible(field) &amp;&amp; !field.isGroup" field-disabled="isApplying"></input-field><div ng-if="field.isGroup" layout="row" layout-sm="column"><input-field ng-repeat="child in field.children | orderBy: \'position\'" field="child" object="object" form="form" ng-if="fieldVisible(child)" flex="" field-disabled="isApplying"></input-field></div></div><div ng-if="submitWithCaptcha" captcha="recaptchaPublicKey"></div><div ng-if="submitError.length &gt; 0" class="bg-danger dialog-notification"><span class="glyphicon glyphicon-exclamation-sign"></span><span ng-bind="submitError"></span></div><div ng-if="submitSuccess.length &gt; 0" class="bg-success dialog-notification"><span class="glyphicon glyphicon-ok-circle"></span><span ng-bind="submitSuccess"></span></div></md-content><div class="md-actions"><md-progress-circular ng-show="isApplying" md-mode="indeterminate" md-diameter="20" class="md-accent"></md-progress-circular><md-button ng-click="submit(form)" aria-label="OK" ng-disabled="isApplying" class="md-raised md-primary"><span>{{ \'OK\' | translate }}</span></md-button><md-button ng-click="cancel()" ng-disabled="isApplying" class="md-raised">{{ \'Cancel\' | translate }}</md-button></div></md-dialog>',"views/webFormMessage.jade":'<md-dialog aria-label="{{title}}" class="input-form"><md-dialog-content><md-subheader>{{title}}</md-subheader></md-dialog-content><md-content><p>{{message}}</p></md-content><div class="md-actions"><md-button ng-click="close()" class="md-primary">{{ \'Main.ButtonOk\' | translate }}</md-button></div></md-dialog>',"views/webFormQuestion.jade":'<div class="modal-header"><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><p>{{message}}</p></div><div class="modal-footer"><div ng-if="submitError.length &gt; 0" class="bg-danger dialog-notification"><span class="glyphicon glyphicon-exclamation-sign"></span><span ng-bind="submitError"></span></div><md-button ng-click="submit()" class="md-raised"><span>{{ \'Main.ButtonYes\' | translate }}</span><md-progress-circular ng-show="isApplying" md-mode="indeterminate"></md-progress-circular></md-button><md-button ng-click="cancel()" class="md-raised md-warn">{{ \'Main.ButtonNo\' | translate }}</md-button></div>'},j=function(){function a(){}return a.FIELD_REPEAT_SUFFIX="$Repeat",a.DIALOG_CLOSE_EVENT="dialog_close",a.VALIDATION_ERROR_MATCH="no_match",a.VALIDATION_ERROR_EMAIL="email",a.VALIDATION_ERROR_NUMBER="number",a.VALIDATION_ERROR_REQUIRED="required",a.VALIDATION_ERROR_MAX_LENGTH="maxlength",a.VALIDATION_ERROR_MIN_LENGTH="minlength",a.VALIDATION_ERROR_URL="url",a.VALIDATION_ERROR_PATTERN="pattern",a.VALIDATION_ERROR_DATE="date",a.VALIDATION_ERROR_TIME="time",a}(),k=(function(){function a(){}return a}(),function(){function a(){}return a.DYNAMIC_FIELD_LIST="dynamic_field_list",a.RICH_TEXT="rich_text",a.CODE_TEXT="code_text",a.SELECT="select",a.MULTI_SELECT="multi_select",a.FILE="file",a.FILE_LIST="file_list",a.PASSWORD="password",a.NUMBER="number",a.EMAIL="email",a.IMAGE="image",a.DATE="date",a.HIDDEN="hidden",a.TEXT="text",a.BOOLEAN="boolean",a.TYPEAHEAD="typeahead",a.MULTILINE_TEXT="multiline_text",a.LABEL="label",a}()),l=function(){function a(){}return a}(),m=(function(){function a(){}return a}(),function(){function a(){this.codeMirrorModules=[],this.smilesBase=null,this.smiles=[],this.maximumFileSize=0,this.requiredErrorMessage="This field is mandatory",this.notEqualErrorMessage="The fields should be equal",this.maxLengthErrorMessage="This field has to be less than {0} characters long",this.minLengthErrorMessage="This field has to be greater than {0} characters long",this.emailErrorMessage="Wrong e-mail address",this.dateErrorMessage="Wrong date",this.timeErrorMessage="Wrong time",this.numberErrorMessage="Wrong number",this.patternErrorMessage="The field doesn't match the pattern specified",this.urlErrorMessage="Wrong URL",this.dataSources={},this.loadModulesOnDemand=!1,this.notFoundMessage="Not found"}return a.prototype.addDataSource=function(a,b){this.dataSources[a]=b},a.prototype.getDataSource=function(a){return this.dataSources[a]},a}()),n=function(){function a(a){this.smiles={},this.smilesString="",this.smilesBase=a.smilesBase,this.autoLinker=new Autolinker,this.autoLinker.newWindow=!1,this.autoLinker.truncate=30;for(var b=0;b<a.smiles.length;b++){var c=a.smiles[b];this.smiles[c.code]=c.id,this.smilesString.length>0&&(this.smilesString+="|");for(var d=0;d<c.code.length;d++){switch(c.code[d]){case"(":case")":case"[":case"]":case"-":case"?":case"|":this.smilesString+="\\"}this.smilesString+=c.code[d]}}this.smilesString.length>0?this.smilesExpression=new RegExp(this.smilesString,"g"):this.smilesExpression=null}return a.prototype.getSmilesExpression=function(){return this.smilesExpression},a.prototype.getSmileUrl=function(a){return a.length&&this.smilesBase?'<img alt="'+a+'" src="'+this.smilesBase+this.smiles[a]+'" title="'+a+'" />':""},a.prototype.smilesToImg=function(a){return null!=this.smilesExpression&&(a=a.replace(/([^<>]*)(<[^<>]*>)/gi,function(a,b,c){return b&&0!=b.length?(b=b.replace(this.smilesExpression,this.getSmileUrl),c?b+c:b):a})),a},a.prototype.getFriendlyHtml=function(a){return null==a||0==a.length?a:(a=this.smilesToImg(a),this.autoLinker.link(a))},a}();h.service("friendlyFormatting",["webFormsConfiguration",n]);var o=function(){function a(a,b,c,d,e){this.httpService=a,this.qService=b,this.cache=c("lm-webforms"),this.dialogService=d,this.configuration=e}return a.prototype.newObject=function(a,b,c){return void 0===b&&(b=null),void 0===c&&(c=null),this.getTemplateAndExecute(a,b,!0,c)},a.prototype.editObject=function(a,b,c){return void 0===c&&(c=null),this.getTemplateAndExecute(a,b,!1,c)},a.prototype.question=function(a,b,c){void 0===c&&(c=null);var d=this.qService.defer();return this.dialogService.show({template:i["views/webFormQuestion.jade"],locals:{message:a,title:b,defer:d,resolver:c},controller:"inputFormQuestion"})["catch"](function(){d.reject()}),d.promise},a.prototype.message=function(a,b){void 0===b&&(b=null);var c=this.qService.defer();return this.dialogService.show({template:i["views/webFormMessage.jade"],locals:{message:a,title:b,defer:c},controller:"inputFormMessage"}),c.promise},a.prototype.getTemplateAndExecute=function(a,b,c,d){var e=this;void 0===d&&(d=null);var f=this.qService.defer();return this.httpService.get(a+".json",{cache:this.cache}).then(function(a){e.executeWithDefinitionLoaded(b,a.data,c,f,d)},function(a){return f.reject(a)}),f.promise},a.fillRichTextModules=function(a){a.push("ckeditor")},a.prototype.fillCodeTextModules=function(a){G.isEmpty(this.configuration.codeMirrorModules)?a.push("codemirror"):G.each(this.configuration.codeMirrorModules,function(b){a.push(b)})},a.prototype.executeWithDefinitionLoaded=function(b,c,d,e,f){var g=this,h=!1,i=!1;G.forOwn(c.fields,function(a,b){a.property=b});var j=[];this.configuration.loadModulesOnDemand&&G.each(c.fields,function(b){switch(b.type){case k.RICH_TEXT:h||(h=!0,a.fillRichTextModules(j));break;case k.CODE_TEXT:i||(i=!0,g.fillCodeTextModules(j))}}),j.length>0?require(j,function(){g.executeWithDefinitionAndModulesLoaded(b,c,d,e,f)}):this.executeWithDefinitionAndModulesLoaded(b,c,d,e,f)},a.prototype.executeWithDefinitionAndModulesLoaded=function(a,b,c,d,e){void 0===e&&(e=null),this.dialogService.show({template:i["views/webForm.jade"],locals:{object:a,definition:b,defer:d,resolver:e,isNew:c},controller:"inputForm"}).then(function(){console.log("ok")})["catch"](function(){console.log("cancel"),d.reject("Cancelled")})},a}(),p=function(){function a(){this.$get=["$http","$q","$cacheFactory","$mdDialog",function(b,c,d,e){return new o(b,c,d,e,a.configuration)}]}return a.prototype.getConfiguration=function(){return a.configuration},a.initialize=function(){a.configuration=new m,h.value("webFormsConfiguration",a.configuration)},a}();p.initialize(),h.provider("webForms",[p]);var q=function(){function a(){}return a.validate=function(a,b,c,d,e,f){switch(c.type){case k.FILE:return c.required&&d&&(null===b||null===b.file||0===b.file.length)&&f(j.VALIDATION_ERROR_REQUIRED),void(e.maximumFileSize>0&&null!==b&&b.file.length>e.maximumFileSize&&f(j.VALIDATION_ERROR_MAX_LENGTH));case k.FILE_LIST:if(c.required&&d&&(null===b||0===b.length)&&f(j.VALIDATION_ERROR_REQUIRED),null!==b)for(var g=0;g<b.length;g++){var h=b[g];if(null!==h.file&&h.file.length>e.maximumFileSize){f(j.VALIDATION_ERROR_MAX_LENGTH);break}}return}if(c.repeat){var i=a[c.reference];G.isEqual(i,b)||f(j.VALIDATION_ERROR_MATCH)}if(G.isEmpty(b))return void(c.required&&f(j.VALIDATION_ERROR_REQUIRED));switch(c.type){case k.NUMBER:isNaN(parseFloat(b))&&f(j.VALIDATION_ERROR_NUMBER);break;case k.EMAIL:G.isString(b)&&b.search(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/)||f(j.VALIDATION_ERROR_EMAIL)}},a}(),r=function(){function a(b,c,d,e,f,g,h){var i=this;this.scope=b,this.dialogService=c,this.object=e,this.definition=angular.copy(f),this.defer=g,this.configuration=d,this.resolver=h,this.scope.title=f.title,b.useCodemirror=G.some(f.fields,function(a){return a.type===k.CODE_TEXT}),b.submitError="",b.isApplying=!1,b.submitWithCaptcha=f.useCaptcha,b.okDisabled=function(a){return i.okDisabled(a)},b.codeMirrorDefaultOptions=a.getCodeMirrorDefaultOptions(),b.isNewObject=null===e,b.object=null!=e?G.copy(e):{},b.fieldVisible=function(a){return a.visibleFunction?a.visibleFunction(b.object):!0},b.submit=function(a){return i.onSubmit(a)},b.cancel=function(){return i.onCancel()},this.initializeFields()}return a.prototype.okDisabled=function(a){return this.scope.isApplying||!G.isUndefined(a)&&a.$invalid},a.getCodeMirrorDefaultOptions=function(){return{mode:"text/html",lineNumbers:!0,lineWrapping:!0,indentWithTabs:!0,theme:"default",extraKeys:{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},Esc:function(a){a.getOption("fullScreen")&&a.setOption("fullScreen",!1)}}}},a.prototype.processField=function(a){switch(a.type){case k.DYNAMIC_FIELD_LIST:this.processDynamicFields(a);break;case k.HIDDEN:break;default:this.addField(a)}},a.prototype.processDynamicFields=function(a){var b=this,c=this.configuration.getDataSource(a.source);if(null!==c&&!G.isUndefined(c)){var d=c.getDynamicFields(a.property,this.scope.object);G.isObject(d)&&G.forOwn(d,function(a,c){var d=G.copy(a);d.property=c,b.addField(d)})}},a.prototype.addField=function(a){if(a.repeat){a=angular.copy(a),a.reference=null,a.repeat=!1,this.addSimpleField(a);var b=angular.copy(a);b.property=a.property+j.FIELD_REPEAT_SUFFIX,b.inlineWithPrevious=!0,b.reference=a.property,b.required=!1,b.repeat=!0,this.addSimpleField(b)}else a.reference=null,this.addSimpleField(a)},a.prototype.addSimpleField=function(a){this.scope.object.hasOwnProperty(a.property)||(G.isUndefined(a.defaultValue)?this.scope.object[a.property]="":this.scope.object[a.property]=a.defaultValue);var b=this.scope.fields;if(a.inlineWithPrevious&&0!==b.length){var c=b[b.length-1];if(c.isGroup)c.children.push(a);else{var d={};d.isGroup=!0,d.type="",d.children=[],d.children.push(c),d.children.push(a),d.position=c.position,d.reference=null,b[b.length-1]=d}}else b.push(a);switch(a.type){case k.IMAGE:case k.FILE:this.scope.object[a.property]=null;break;case k.SELECT:case k.MULTI_SELECT:if(!G.isArray(a.items)&&G.isString(a.source)){var e=this.configuration.getDataSource(a.source);e?a.items=e.getSelectItems(a.source,this.object):a.items={}}a.itemsArray=[],G.forOwn(a.items,function(b,c){var d=new l;G.isString(b)?(d.key=c,d.text=b,d.isGroup=!1):(d.text=c,d.isGroup=!0,d.items=[],G.forOwn(b,function(a,b){var c=new l;c.key=b,c.text=a,c.isGroup=!1,d.items.push(c)})),a.itemsArray.push(d)});break;case k.DATE:a.isOpen=!1}if(G.isBoolean(a.visible)||G.isString(a.visible))if(G.isBoolean(a.visible)){var f=a.visible;a.visibleFunction=function(a){return f}}else a.visibleFunction=new Function("obj","with(obj) { return "+a.visible+"; }");else a.visibleFunction=null;if(G.isBoolean(a.readOnly)||G.isString(a.readOnly))if(G.isBoolean(a.readOnly)){var g=a.readOnly;a.readOnlyFunction=function(a){return g}}else a.readOnlyFunction=new Function("obj","with(obj) { return "+a.readOnly+"; }");else a.readOnlyFunction=null},a.prototype.initializeFields=function(){var a=this;this.scope.fields=[],G.each(this.definition.fields,function(b){a.processField(b)})},a.prototype.onCloseDialog=function(){this.scope.$broadcast(j.DIALOG_CLOSE_EVENT)},a.prototype.onOk=function(){this.onCloseDialog(),this.dialogService.hide("ok")},a.prototype.onCancel=function(){this.onCloseDialog(),this.dialogService.hide("cancel")},a.prototype.validateField=function(a,b){var c=this;if(!(!this.scope.fieldVisible(a)||a.readOnly||a.readOnlyFunction&&a.readOnlyFunction(this.scope.object))){if(a.isGroup)return void G.each(a.children,function(a){c.validateField(a,b)});var d=b[a.property];if(!G.isUndefined(d)){var e=this.scope.object[a.property];q.validate(this.scope.object,e,a,this.scope.isNewObject,this.configuration,function(a){d.$setDirty(),d.$setValidity(a,!1)})}}},a.prototype.onSubmit=function(a){var b=this;if(G.each(this.scope.fields,function(c){b.validateField(c,a)}),!a.$invalid){this.scope.submitWithCaptcha&&(this.scope.object["-RecaptchaChallenge-"]=Recaptcha.get_challenge(),this.scope.object["-RecaptchaResponse-"]=Recaptcha.get_response()),this.scope.submitError="",this.scope.isApplying=!0;try{var c=G.copy(this.scope.object);if(G.each(this.scope.fields,function(a){a.repeat&&delete c[a.property+j.FIELD_REPEAT_SUFFIX]}),null==this.resolver)return this.onOk(),void this.defer.resolve(c);this.resolver(c).then(function(){b.scope.isApplying=!1,b.onOk(),null!=b.defer&&b.defer.resolve(c)},function(a){b.scope.isApplying=!1,b.scope.submitError=a,b.scope.submitWithCaptcha&&Recaptcha.reload()})}catch(d){this.scope.isApplying=!1,this.scope.submitError=d.toString()}}},a}();h.controller("inputForm",["$scope","$mdDialog","webFormsConfiguration","object","definition","defer","resolver",r]);var s=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},t=function(a){function b(b,c,d,e){var f=this;a.call(this,b,c,d,b.configuration.object,b.definition,null,function(a){return f.successFunction(a)}),this.qService=e,this.dialogScope=b,b.submitError="",b.submitSuccess="",b.hasChanges=!1,b.changesApplied=!1,b.openForm=function(a){a.$setPristine(),b.changesApplied=!1,b.submitError="",b.submitSuccess=""},b.$watch("object",function(a,b){a!==b&&f.onDataChanged()},!0)}return s(b,a),b.prototype.okDisabled=function(b){return a.prototype.okDisabled.call(this,b)||!this.dialogScope.hasChanges},b.prototype.onDataChanged=function(){this.dialogScope.hasChanges=!0,this.dialogScope.submitError="",this.dialogScope.submitSuccess=""},b.prototype.successFunction=function(a){var b=this,c=this.qService.defer();return this.dialogScope.submit(a).then(function(a){b.dialogScope.hasChanges=!1,b.dialogScope.changesApplied=!0,b.dialogScope.submitSuccess=a.message,c.resolve()},function(a){return c.reject(a)}),c.promise},b}(r);h.controller("dialog",["$scope","$mdDialog","webFormsConfiguration","commandProcessor","$q",t]);var u=function(){function a(a,b,c,d,e){a.message=c,a.title=d,a.close=function(){b.hide(),e.resolve()}}return a}();h.controller("inputFormMessage",["$scope","$mdDialog","message","title","defer",u]);var v=function(){function a(a,b,c,d,e,f){a.message=c,a.title=d,a.submitError="",a.isApplying=!1,a.close=function(){null==f&&(b.hide(),e.resolve()),a.submitError="",a.isApplying=!0;var c=f();c.then(function(){b.hide(),a.isApplying=!1,e.resolve()},function(b){a.submitError=b,a.isApplying=!1})}}return a}();h.controller("inputFormQuestion",["$scope","$mdDialog","message","title","defer","resolver",v]);var w=function(){function a(){}return a}(),x=function(){function a(a,b,c,d,e,f,g){var h=this;this.smileIdToCode={},this.smileCodeToId={},this.configuration=e,this.options=new w,this.scope=a,this.friendlyFormatting=f,this.model=c,this.inputContainer=d,this.initializeSmiles(),d.setHasValue(!0),this.editor=g.appendTo(b[0],this.options),this.editor.on("change",function(){return h.applyChanges()}),this.editor.on("key",function(){return h.applyChanges()}),this.editor.on("focus",function(){return h.inputContainer.setFocused(!0)}),this.editor.on("blur",function(){return h.inputContainer.setFocused(!1)}),c.$render=function(){return h.render()}}return a.prototype.updateEditorState=function(a){this.inputContainer.setHasValue(!0),this.inputContainer.setInvalid(this.model.$invalid&&this.model.$touched)},a.prototype.render=function(){var a=this.model.$viewValue||"";a&&this.friendlyFormatting.getSmilesExpression()&&(a=this.friendlyFormatting.smilesToImg(a)),this.editor.setData(a),this.updateEditorState(a)},a.prototype.applyChanges=function(){var a=this;this.scope.$apply(function(){return a.setViewValue()})},a.prototype.setViewValue=function(){var a=this,b=this.editor.getData();null!=this.friendlyFormatting.getSmilesExpression()&&(b=b.replace(/<img\s+alt="([^"]*)"\s+src="[^"]*"\s+(?:style="[^"]*"\s+)?title="([^"]*)"\s+\/?>/gi,function(b,c,d){return c&&d&&c==d&&a.smileCodeToId.hasOwnProperty(c)?c:b})),this.model.$setViewValue(b),this.model.$setTouched(),this.updateEditorState(b)},a.prototype.initializeSmiles=function(){var a=this;this.configuration.smilesBase&&0!==this.configuration.smilesBase.length&&this.configuration.smiles&&0!==this.configuration.smiles.length&&(this.options.smiley_path=this.configuration.smilesBase,this.options.smiley_descriptions=[],this.options.smiley_images=[],G.each(this.configuration.smiles,function(b){a.smileCodeToId[b.code]=b.id,a.smileIdToCode[b.id]=b.code,a.options.smiley_descriptions.push(b.code),a.options.smiley_images.push(b.id)}))},a}();h.directive("ckEditor",["webFormsConfiguration","friendlyFormatting",function(a,b){return{require:["?ngModel","^?mdInputContainer"],restrict:"AE",replace:!1,scope:{options:"=",readonly:"="},link:function(c,d,e,f){require(["ckeditor"],function(e){return new x(c,d,f[0],f[1],a,b,e)})}}}]);var y=function(){function a(a,b,c,d,e){
var f=this;this.scope=a,this.model=c,this.inputContainer=d,this.element=b,this.configuration=e,G.isFunction(a.options)&&(this.options=a.options()),angular.isObject(this.options)||(this.options={});var g=this.model.$viewValue||"";if(this.options.lineNumbers=!0,this.options.mode=this.options.mode||"htmlmixed",this.options.inputStyle="textarea",this.options.value=g,e.loadModulesOnDemand){var h=["codemirror"];e.codeMirrorModules&&e.codeMirrorModules.length&&(h=e.codeMirrorModules),require(h,function(a){f.prepareEditor(a)})}else this.prepareEditor(window.CodeMirror)}return a.prototype.prepareEditor=function(a){var b=this;this.editor=this.createEditor(a),this.scope.$applyAsync(function(){b.configOptionsWatcher(a),b.configNgModelLink(),b.editor.setOption("readOnly",b.scope.fieldReadonly)})},a.prototype.createEditor=function(a){var b=this;return new a(function(a){b.element.append(a)},this.options)},a.prototype.configOptionsWatcher=function(a){var b=this,c=Object.keys(a.defaults);this.scope.$watch("options",function(a,d){angular.isObject(a)&&c.forEach(function(c){if(a.hasOwnProperty(c)){if(d&&a[c]===d[c])return;b.editor.setOption(c,a[c])}})},!0),this.scope.$watch("fieldReadonly",function(a,c){a!==c&&b.editor.setOption("readOnly",a)})},a.prototype.updateEditorState=function(a){this.inputContainer.setHasValue(!G.isEmpty(a)),this.inputContainer.setInvalid(this.model.$invalid&&this.model.$touched)},a.prototype.configNgModelLink=function(){var a=this;this.model&&(this.model.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-codemirror cannot use an object or an array as a model");return a}),this.model.$render=function(){var b=a.model.$viewValue||"";a.editor.setValue(b),a.updateEditorState(b)},this.editor.on("change",function(b){var c=b.getValue();c!==a.model.$viewValue&&a.scope.$evalAsync(function(){a.model.$setViewValue(c),a.model.$setTouched(),a.updateEditorState(c)})}),this.editor.on("focus",function(){a.inputContainer.setFocused(!0)}),this.editor.on("blur",function(){a.inputContainer.setFocused(!1)}))},a}();h.directive("uiCodemirror",["webFormsConfiguration",function(a){return{restrict:"E",template:i["views/codemirror.jade"],replace:!0,require:["?ngModel","^?mdInputContainer"],scope:{options:"&",fieldReadonly:"=",fieldDisabled:"="},link:function(b,c,d,e){new y(b,c,e[0],e[1],a)}}}]),h.directive("lmDialog",[function(){return{template:i["views/webDialog.jade"],restrict:"E",replace:!1,scope:{configuration:"="},controller:t}}]);var z=function(){function a(a,b,c,d,e){var f=this;this.scope=a,this.scope.showImage=this.scope.showImage||!1,this.element=b,this.imageElement=null,this.scope.comment="",this.scope.configuration=c,this.model=d,this.container=e,this.scope.valueSet=G.isObject(this.model.$modelValue),this.scope.imageLoaded=!1,this.fileElement=b.find("input"),a.chooseFile=function(){f.fileElement[0].click()},a.clear=function(){f.fileElement.val(""),f.fileElement.html(""),f.model.$setViewValue(null),f.scope.comment="",f.container.setHasValue(!1),f.scope.valueSet=!1,f.imageElement&&(f.imageElement.html(""),f.scope.imageLoaded=!1)},this.fileElement.bind("change",function(a){return f.onFileSelected(a)})}return a.prototype.onFileSelected=function(a){var b=this;if(0!==a.target.files.length){var c=a.target.files[0];this.scope.comment=c.name;var d=new FileReader;d.onload=function(c){b.scope.$apply(function(){return b.onReadFinished(c,a)})},d.readAsDataURL(c)}},a.prototype.onReadFinished=function(a,b){var c=this,d=a.target.result;if(this.scope.showImage){var e=d.match(/^data:([a-zA-Z+_]+)\/([^;]+);/),f=e[1];if("image"!==f)return void this.scope.clear();null==this.imageElement&&(this.imageElement=this.element.find("canvas"));var g=new Image;g.onload=function(){var a=c.imageElement[0],b=a.getContext("2d");b.drawImage(g,0,0,a.width,a.height),c.scope.imageLoaded=!0},g.src=d}var h=d.indexOf("base64,");h>0&&(d=d.substring(h+7));var i=b.target.files[0];this.container.setHasValue(!0),this.model.$setViewValue({file:d,type:i.type,name:i.name,id:null}),this.model.$setDirty(),this.model.$setTouched(),this.scope.valueSet=!0},a}();h.directive("fileRead",["webFormsConfiguration",function(a){return{template:i["views/fileRead.jade"],restrict:"E",replace:!1,require:["?ngModel","^?mdInputContainer"],scope:{showImage:"="},link:function(b,c,d,e){new z(b,c,a,e[0],e[1])}}}]);var A=function(){function a(a,b,c,d,e,f){var g=this;this.scope=a,this.scope.configuration=e,this.element=b,this.compileService=c,this.configuration=e,this.scope.getCodeMirrorOptions=function(){return{}},a.getValue=function(){return a.field.type===k.RICH_TEXT&&a.readOnly().length>0?d.trustAsHtml(a.object[a.field.property]):a.object[a.field.property]},a.getTypeahead=function(b){var c=e.getDataSource(a.field.source);return c?c.searchItems(b):[]},a.onSearchTextChange=function(){},a.onSelectedItemChange=function(b){f[a.field.property]},a.getHelpText=function(){return g.onGetHelpText()},a.readOnly=function(){return a.field.readOnlyFunction?a.field.readOnlyFunction(a.object)?"readonly":"":a.field.readOnly?"readonly":""},a.$watch("field",function(){return g.render()})}return a.prototype.onGetHelpText=function(){var a=this.scope.field.helpText;return null==a&&(a=""),a},a.prototype.getTemplateUrl=function(){return"views/inputFields/"+g(this.scope.field.type.toLowerCase())+".jade"},a.prototype.render=function(){this.onContentLoaded(i[this.getTemplateUrl()])},a.prototype.onContentLoaded=function(a){if(this.element.contents().remove(),G.isObject(this.scope.field)){switch(a=F.format(a,this.scope.field.property),this.scope.field.type){case k.TYPEAHEAD:break;default:a="<md-input-container class='inputfield-"+this.scope.field.type+"'>"+a+"<input-field-error></input-field-error></md-input-container>"}var b=angular.element(this.element);b.append(a);var c=b.children("md-input-container:last-child")[0];this.compileService(c)(this.scope)}},a}();h.directive("inputField",["$compile","webFormsConfiguration","$sce",function(a,b,c){return{restrict:"EA",require:["^form"],scope:{field:"=",object:"=",fieldDisabled:"=",form:"="},link:function(d,e,f,g){new A(d,e,a,c,b,g[0])}}}]);var B=function(){function a(a,b,c){a.configuration=c,a.maxLengthMessage="",a.requiredMarker=j.VALIDATION_ERROR_REQUIRED,a.maxLengthMarker=j.VALIDATION_ERROR_MAX_LENGTH,a.minLengthMarker=j.VALIDATION_ERROR_MIN_LENGTH,a.emailMarker=j.VALIDATION_ERROR_EMAIL,a.urlMarker=j.VALIDATION_ERROR_URL,a.patternMarker=j.VALIDATION_ERROR_PATTERN,a.dateMarker=j.VALIDATION_ERROR_DATE,a.timeMarker=j.VALIDATION_ERROR_TIME,a.numberMarker=j.VALIDATION_ERROR_NUMBER,a.equalsMarker=j.VALIDATION_ERROR_MATCH,a.field.maxLength&&b(c.maxLengthErrorMessage).then(function(b){return a.maxLengthMessage=F.format(b,a.field.maxLength)}),a.minLengthMessage="",a.field.minLength&&b(c.minLengthErrorMessage).then(function(b){return a.minLengthMessage=F.format(b,a.field.minLength)})}return a}();h.directive("inputFieldError",[function(){return{template:i["views/inputFieldError.jade"],restrict:"E",replace:!0,controller:["$scope","$translate","webFormsConfiguration",B]}}]);var C=function(){function a(){this.files=[]}return a}(),D=function(){function a(a,b,c,d,e){var f=this;this.fileId=1,this.model=d,this.container=e,this.scope=a,this.scope.configuration=c,this.value=this.model.$modelValue,this.scope.valueSet=G.isObject(this.value),this.scope.comment="",this.scope.valueSet?this.fileReadBefore=this.value.files.length:(this.value=new C,this.fileReadBefore=0,this.model.$setViewValue(null)),this.scope.files=this.value.files,this.fileElement=b.find("input"),a.chooseFile=function(){f.fileElement[0].click()},a.removeFile=function(a){f.removeFile(a)},this.fileElement.bind("change",function(a){return f.onFilesSelected(a)})}return a.prototype.removeFile=function(a){for(var b=0;b<this.value.files.length;b++)if(this.value.files[b].id==a.id){this.value.files.splice(b,1);break}0===this.value.files.length&&(this.model.$setViewValue(null),this.scope.comment="",this.container.setHasValue(!1),this.scope.valueSet=!1)},a.prototype.onFilesSelected=function(a){var b=this,c=a.target.files;G.each(c,function(a){b.readFile(a,c)})},a.prototype.onReadFinished=function(a,b,c){var d=a.target.result,e=d.indexOf("base64,");e>0&&(d=d.substring(e+7));var f={file:d,type:b.type,name:b.name,id:this.fileId++};this.value.files.push(f),this.value.files.length-this.fileReadBefore==c.length&&this.fileElement.val(""),1===this.value.files.length&&(this.model.$setViewValue(this.value),this.scope.valueSet=!0),this.model.$setDirty(),this.model.$setTouched()},a.prototype.readFile=function(a,b){var c=this,d=new FileReader;d.onload=function(d){c.scope.$apply(function(){return c.onReadFinished(d,a,b)})},d.readAsDataURL(a)},a}();h.directive("multiFileRead",["webFormsConfiguration",function(a){return{template:i["views/multiFileRead.jade"],restrict:"E",replace:!1,require:["?ngModel","^?mdInputContainer"],scope:!0,link:function(b,c,d,e){new D(b,c,a,e[0],e[1])}}}]);var E=function(){function a(a,b,c){var d=this;G.isEmpty(b.validateEquals)||(this.model=c,this.attrs=b,a.$watch(b.ngModel,function(){return d.validate()}),b.$observe("reference",function(){return d.validate()}))}return a.prototype.validate=function(){var a=this.model.$viewValue,b=this.attrs.reference;this.model.$setValidity(j.VALIDATION_ERROR_MATCH,G.isEqual(a,b))},a}();h.directive("validateEquals",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){new E(a,c,d)}}}]);var F=function(){function a(){}return a.format=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return a.replace(/{(\d+)}/g,function(a,c){return G.isUndefined(b[c])?a:b[c]})},a}(),G=function(){function a(){}return a.isBoolean=function(a){return a===!0||a===!1},a.copy=function(a){return angular.copy(a)},a.forOwn=function(b,c){if(null!==b&&!a.isUndefined(b)){var d=Object.getOwnPropertyNames(b);angular.forEach(d,function(a){c(b[a],a)})}},a.isString=function(a){return angular.isString(a)},a.each=function(a,b){angular.forEach(a,b)},a.isArray=function(a){return angular.isArray(a)},a.isUndefined=function(a){return angular.isUndefined(a)},a.isDefined=function(a){return angular.isDefined(a)},a.isDate=function(a){return angular.isDate(a)},a.isFunction=function(a){return angular.isFunction(a)},a.isObject=function(a){return angular.isObject(a)},a.isEmpty=function(b){return null===b||a.isUndefined(b)?!0:a.isArray(b)||a.isString(b)||a.isFunction(b)?0===b.length:a.isObject(b)?0===Object.getOwnPropertyNames(b).length:a.isBoolean(b)||a.isDate(b)?!1:!0},a.union=function(b,c){var d=[];return a.isArray(b)&&a.each(b,function(a){d.push(a)}),a.isArray(c)&&a.each(c,function(b){for(var c=0;c<d.length;c++)if(a.isEqual(d[c],b))return;d.push(b)}),d},a.some=function(b,c){if(a.isArray(b)){for(var d=0;d<b.length;d++)if(c(b[d]))return!0;return!1}if(a.isObject(b)){for(var e=Object.getOwnPropertyNames(b),d=0;d<e.length;d++){var f=e[d];if(c(b[f],f))return!0}return!1}return!1},a.isEqual=function(b,c){if(null===b&&null===c)return!0;if(null===b||null===c)return!1;if(a.isUndefined(b)||a.isUndefined(c))return!1;if(a.isArray(b)){if(!a.isArray(c))return!1;var d=b.length;if(d!==c.length)return!1;for(var e=0;d>e;e++)if(!a.isEqual(b[e],c[e]))return!1;return!0}if(a.isObject(b)){if(!a.isObject(c))return!1;var f=Object.getOwnPropertyNames(b).sort(),g=Object.getOwnPropertyNames(c).sort();if(!a.isEqual(f,g))return!1;for(var e=0;e<f.length;e++){var h=f[e];if(!a.isEqual(b[h],c[h]))return!1}return!0}return b===c},a}()});